# ast-set2matrix

Program for step-by-step conversion of AST set to the matrix (dataset) using [**ast2vec**](https://github.com/PetukhovVictor/ast2vec)

Available steps (stages):
- **asts2vectors**: ast from specified input folder conversion to vectors in specified output folder (with same path);
- **sparse_transformation**: convert "vectors" (but actually is map "feature-value") to sparse representation (two formats: matrix or map);
- **normalize**: normalization feature values by the number of all features in the current file;
- **collect_statistic**: collection features statistic (create sorted lists with features and their frequency for specified n).

## Program use
### asts2vectors
#### Program arguments

* **-s, --stage** -> asts2vectors;
* **-i, --input_folder**: input folder with ASTs (in JSON format);
* **-o, --output_folder**: output folder with "vectors" (but actually is map "feature-value");
* **--ast2vec_path**: path to [ast2vec](https://github.com/PetukhovVictor/ast2vec)

Also see ast2vec README: https://github.com/PetukhovVictor/ast2vec (ASTs format, output format, etc)

At this stage a file with all features is generated (all_features.json in the output folder). **This file required in the next stages.**

#### Example of use
```
python3 main.py -i ./ast -o ./ast_vectors -s asts2vectors --ast2vec_path ../ast2vec/
```

### sparse_transformation
#### Program arguments

* **-s, --stage** -> sparse_transformation;
* **-i, --input_folder**: input folder with "vectors" (but actually is map "feature-value") - from previous stage (asts2vectors);
* **-o, --output_folder**: output folder with sparsed "vectors" (but actually is map "feature-value");
* **--sparse_format**: list or map.
* **--all_features_file**: file with all feature generated by asts2vectors stage.

#### Output format

If the 'list' was specified (for example):
```
[4, 0, 0, 11, 0, 0, 0, 12, 0, 0, 0, 0, 65, 4, 0, 0, 0, 0, 0, 91, 0, 1, 0, 0, 0, 0, 0, 0, 45, 0, 0, 103, 0, 0, 0, 0, 0, 9, 3]
```

if the 'map' was specified (for example):
```
{"FUN": 14, "MODIFIER_LIST": 3, "FUN:MODIFIER_LIST": 1, "public": 0, "MODIFIER_LIST:public": 0, "FUN:public": 1, "FUN:MODIFIER_LIST:public": 0, "MODIFIER_LIST:WHITE_SPACE": 0, "FUN:MODIFIER_LIST:WHITE_SPACE": 0, "open": 8, "MODIFIER_LIST:open": 0, "FUN:open": 1, "FUN:MODIFIER_LIST:open": 0, "fun": 1, "FUN:fun": 0, "FUN:IDENTIFIER": 2, "VALUE_PARAMETER_LIST": 3, "FUN:VALUE_PARAMETER_LIST": 0, "VALUE_PARAMETER_LIST:LPAR": 1, "FUN:LPAR": 1, "FUN:VALUE_PARAMETER_LIST:LPAR": 0, "VALUE_PARAMETER": 6, "VALUE_PARAMETER_LIST:VALUE_PARAMETER": 1, "FUN:VALUE_PARAMETER": 1, "FUN:VALUE_PARAMETER_LIST:VALUE_PARAMETER": 0, "VALUE_PARAMETER:IDENTIFIER": 1, "VALUE_PARAMETER_LIST:IDENTIFIER": 1, "VALUE_PARAMETER_LIST:VALUE_PARAMETER:IDENTIFIER": 0, "FUN:VALUE_PARAMETER:IDENTIFIER": 1, "FUN:VALUE_PARAMETER_LIST:IDENTIFIER": 0, "COLON": 2, "VALUE_PARAMETER:COLON": 0, "VALUE_PARAMETER_LIST:COLON": 1, "FUN:COLON": 22, "VALUE_PARAMETER_LIST:VALUE_PARAMETER:COLON": 2, "FUN:VALUE_PARAMETER:COLON": 0, "FUN:VALUE_PARAMETER_LIST:COLON": 0, "VALUE_PARAMETER:WHITE_SPACE": 13}
```

#### Example of use
```
main.py -i ./ast_vectors -o ./ast_vectors_sparsed -s sparse_transformation --all_features_file ./ast_vectors/all_features.json
```
